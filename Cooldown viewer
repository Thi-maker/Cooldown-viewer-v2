local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Cooldown Viewer - Lock Edition",
    LoadingTitle = "Carregando...",
    LoadingSubtitle = "by Thiüáßüá∑",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil, 
        FileName = "CooldownViewer"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink", 
        RememberJoins = true 
    },
    KeySystem = false, 
})

local Tab = Window:CreateTab("Principal", 4483362458)
local Section = Tab:CreateSection("Monitoramento de Skills")

-- Servi√ßos
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Vari√°veis de Controle
local ViewerEnabled = false
local UpdateLoop = nil
local CreatedGuis = {} 

-- Fun√ß√£o principal de verifica√ß√£o de status
local function GetToolStatus(tool)
    local name = tool.Name
    
    -- Tenta pegar um valor de tempo (apenas para exibi√ß√£o informativa se existir)
    local cooldownTime = tool:GetAttribute("Cooldown") or tool:GetAttribute("CD") or tool:GetAttribute("Reload")
    
    if not cooldownTime then
        local valObj = tool:FindFirstChild("Cooldown") or tool:FindFirstChild("ReloadTime")
        if valObj and (valObj:IsA("NumberValue") or valObj:IsA("IntValue")) then
            cooldownTime = valObj.Value
        end
    end
    
    -- L√ìGICA VISUAL
    if tool.Enabled then
        -- ESTADO: PRONTO (Verde com c√≠rculo)
        return string.format('<font color="rgb(0,255,0)">üü¢ %s [PRONTO]</font>', name)
    else
        -- ESTADO: EM COOLDOWN (Vermelho com CADEADO üîí)
        local timeText = cooldownTime and tostring(cooldownTime).."s" or "..."
        return string.format('<font color="rgb(255,0,0)">üîí %s [CD: %s]</font>', name, timeText)
    end
end

-- Fun√ß√£o para criar/atualizar a BillboardGui
local function UpdateBillboard(player)
    -- Verifica se o player e o personagem existem
    if not player or not player.Character then return end
    
    local head = player.Character:FindFirstChild("Head")
    if not head then return end
    
    local guiName = "CD_Viewer_ESP"
    
    -- Cria a GUI se n√£o existir
    local bgui = head:FindFirstChild(guiName)
    if not bgui then
        bgui = Instance.new("BillboardGui")
        bgui.Name = guiName
        bgui.Size = UDim2.new(0, 200, 0, 150)
        bgui.StudsOffset = Vector3.new(0, 4.5, 0) -- Levemente mais alto para n√£o atrapalhar o nome
        bgui.AlwaysOnTop = true
        bgui.Parent = head
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Parent = bgui
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextStrokeTransparency = 0 -- Borda preta para leitura
        textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        textLabel.TextSize = 13
        textLabel.Font = Enum.Font.GothamBold
        textLabel.RichText = true -- Habilita formata√ß√£o HTML para cores e √≠cones
        textLabel.TextYAlignment = Enum.TextYAlignment.Bottom
        
        table.insert(CreatedGuis, bgui)
    end
    
    local label = bgui:FindFirstChildOfClass("TextLabel")
    local contentText = ""
    
    -- 1. Verifica Tools equipadas (no Character)
    for _, item in pairs(player.Character:GetChildren()) do
        if item:IsA("Tool") then
            contentText = contentText .. GetToolStatus(item) .. "\n"
        end
    end
    
    -- 2. Verifica Tools guardadas (na Backpack)
    local backpack = player:FindFirstChild("Backpack")
    if backpack then
        for _, item in pairs(backpack:GetChildren()) do
            if item:IsA("Tool") then
                contentText = contentText .. GetToolStatus(item) .. "\n"
            end
        end
    end
    
    label.Text = contentText
end

-- Limpa todas as GUIs
local function ClearAll()
    for _, gui in pairs(CreatedGuis) do
        if gui and gui.Parent then
            gui:Destroy()
        end
    end
    CreatedGuis = {}
    
    -- Varredura extra de seguran√ßa
    for _, p in pairs(Players:GetPlayers()) do
        if p.Character and p.Character:FindFirstChild("Head") then
            local old = p.Character.Head:FindFirstChild("CD_Viewer_ESP")
            if old then old:Destroy() end
        end
    end
end

local Toggle = Tab:CreateToggle({
    Name = "Ativar Visualizador (Com Cadeado üîí)",
    CurrentValue = false,
    Flag = "CooldownToggle", 
    Callback = function(Value)
        ViewerEnabled = Value
        
        if ViewerEnabled then
            -- Loop r√°pido
            UpdateLoop = RunService.RenderStepped:Connect(function()
                for _, player in pairs(Players:GetPlayers()) do
                    pcall(function()
                        UpdateBillboard(player)
                    end)
                end
            end)
        else
            if UpdateLoop then
                UpdateLoop:Disconnect()
                UpdateLoop = nil
            end
            ClearAll()
        end
    end,
})

Rayfield:Notify({
    Title = "Script Carregado",
    Content = "√çcone de Cooldown alterado para üîí",
    Duration = 5,
    Image = 4483362458,
})
